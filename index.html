<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            overflow-y: hidden;
            overflow-x: hidden;
            font-family: "Courier new", "Cambria";
        }
        canvas {
            width: 100%;
            height: auto;
            border: 1px black solid;
            overflow-y: hidden;
            overflow-x: hidden;
        }
        header {
            text-align: center;

        }
        footer {
            text-align: center;
        }
    </style>

    <title>Document</title>
</head>
<body onload="innit()">
    <header>
        <h1>Dig UP!</h1>
        <span>Archeology-base memory game.</span>
    </header>
    <main>
        <span id="output">Output:</span>
        <canvas id="Window">This element is unsupported.</canvas>
    </main>
    <footer>
        <span>Are you having trouble with this game? I have made a quick peice of information to assit you on your digging. <a target="_blank" href="html/help.html">Click here.</a></span>
    </footer>


    <script>
        mx = 2;
        mz = 2;
        vx = 0;
        vz = 0;

        MapX = 100;
        MapZ = 100;

        ox = 2;
        oz = 2;

        function innit() {
            canvas = document.getElementById("Window");
            ctx = canvas.getContext("2d");

            document.addEventListener("keydown", keyDown);
            document.addEventListener("keyup", keyUp);
            document.addEventListener("click", click);

            // array for tile gen

            map = map_Gen(1, 100, 0, MaxX, MaxZ);

            setInterval(main, 20);
            setInterval(draw, 20);
        }

        function main() {
            clear();
            map_Render((MapX+ox), (MapZ+oz), (ox-mx), (oz-mz), 10, 10);

            if (vx != 0 && (mx+vx > oz-1 && mx+vx <  MapX+ox-1)) {
                mx += vx;
            }
            if (vz != 0 && (mz+vz > oz-1 && mz+vz < MapZ+oz-1)) {
                mz += vz;
            }
        }

        function map_Render(maxX, maxZ, cx, cz, size_x, size_z) {
            temp_x = 0;
            temp_z = 0;
            for (x = cx; x < maxX; x++) {
                for (z = cz; z < maxZ; z++) {
                    draw(1, true, "hsl(210, 100%, 40%)", x*size_x, z*size_z, size_x, size_z);
                }
            }
        }

        function map_Gen(gradient, MaxV, MinV, MaxX, MaxZ) {
            var gen = [];
            var temp_gen = [];
            n = 0;

            // Initializer
            for (x = 0; x < MaxX; x++) {
                for (z = 0; z < MaxZ; z++) {
                    temp_gen.push(0);
                }
                gen.push(temp_gen);
                temp_gen = [];
            }

            for (x = 0; x < MaxX; x++) {
                for (z = 0; z < MaxZ; z++) {
                    r = Math.random()*4;
                    diff = 0;
                    if (Math.round(r) == 0) {
                        diff = gradient * -1;
                    }
                    if (Math.round(r) == 1) {
                        diff = 0;
                    }
                    if (Math.round(r) == 2) {
                        diff = gradient;
                    }

                    for (t = 0; t < 5; t ++) {
                        if (gen[x][z]+diff > 100 && gen[x][z]+diff < 0) {
                            gen[x][z] = gen[x][z]+diff;
                        }
                        if (x-1 > 0 && x+1 < MaxX) {
                            if (t == 1 && gen[x-1][z]+diff > 100 && gen[x-1][z]+diff < 0) {
                                gen[x-1][z] = gen[x-1][z]+diff;
                            }
                            if (t == 2 && gen[x+1][z]+diff > 100 && gen[x+1][z]+diff < 0) {
                                gen[x+1][z] = gen[x+1][z]+diff;
                            }
                        }

                        if (z-1 > 0 && z+1  < MaxZ) {
                            if (t == 3 && x > 0 && gen[x][z-1]+diff > 100 && gen[x][z-1]+diff < 0) {
                                gen[x][z-1] = gen[x][z-1]+diff;
                            }
                            if (t == 4 && x > 0 && gen[x][z+1]+diff > 100 && gen[x][z+1]+diff < 0) {
                                gen[x][z] = gen[x][z]+diff;
                            }
                        }
                    }
                }
            }
            return gen;
        }

        function keyDown() {
            // document.getElementById("output").innerHTML = event.keyCode;

            var keyCode = event.keyCode;

            if (keyCode == 87) {
                vz = 1;
            }
            if (keyCode == 65) {
                vx = -1;
            }
            if (keyCode == 68) {
                vx = 1;
            }
            if (keyCode == 83) {
                vz = -1;
            }
        }

        function keyUp() {
            // document.getElementById("output").innerHTML = "Key Up";

            var keyCode = event.keyCode;

            if (keyCode == 87) {
                vz = 0;
            }
            if (keyCode == 65) {
                vx = 0;
            }
            if (keyCode == 68) {
                vx = 0;
            }
            if (keyCode == 83) {
                vz = 0;
            }
        }

        function click() {
            // document.getElementById("output").innerHTML = "Mouse Click";
        }

        function draw(type, fill, color, x, y, size_x, size_y) {
            ctx.beginPath();

            if (type == 1 && fill == false) {
                ctx.rect(x, y, size_x, size_y);
            }
            if (color != "") {
                if (type == 1 && fill == true) {
                    ctx.fillStyle = color;
                    ctx.fillRect(x, y, size_x, size_y);
            }
            }


            if (fill == true && color == "") {
                ctx.fill();
            }

            ctx.stroke()
        }
        
        function clear() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    </script>
</body>
</html>